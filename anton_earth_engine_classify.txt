// anton's earth engine script "classify"

ar iceHigh = /* color: #ff0000 */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-143.89062436617712, 61.94463661752425],
               [-143.828826270474, 61.9233147272798],
               [-143.75466855563025, 61.9233147272798],
               [-143.76016171969275, 61.979817470722736],
               [-143.883757911099, 61.99819865021055],
               [-143.93182309664587, 61.99819865021055]]],
             [[[-142.92946799733954, 61.68205086400513],
               [-142.8450105998786, 61.67195189520119],
               [-142.81342490651923, 61.69247214214991],
               [-142.82990439870673, 61.70874834670912],
               [-142.8779695842536, 61.720136581256476],
               [-142.93976767995673, 61.70679565554693]]],
             [[[-140.98956587775547, 60.37897181389212],
               [-141.00467207892734, 60.42323107495329],
               [-141.15436079963047, 60.43153357598226],
               [-141.14852431281406, 60.45388895033524],
               [-141.36722090705234, 60.4626913904604],
               [-141.37717726691562, 60.42068906912932]]],
             [[[-151.19395003770126, 63.02135138154079],
               [-151.19395003770126, 63.00499291350807],
               [-151.1585877940489, 63.0060837633984],
               [-151.16442428086532, 63.021507132387434],
               [-151.1524079844786, 63.03676668124126],
               [-151.18193374131454, 63.05388523533269],
               [-151.2234757945372, 63.04190330355012]]],
             [[[-150.9602489547321, 63.072859507534346],
               [-150.94067955775944, 63.06181860745224],
               [-150.92557335658756, 63.07177115416904],
               [-150.9499492721149, 63.08513953128872],
               [-150.97398186488834, 63.07830066387327]]],
             [[[-146.56462034828394, 63.47876580947256],
               [-146.5412744010183, 63.455300717740116],
               [-146.50934538490503, 63.41983654898306],
               [-146.4179017622597, 63.38706112805168],
               [-146.47935653520892, 63.43868982876508],
               [-146.5105989058144, 63.46615647105782],
               [-146.4999559004433, 63.475050624914665],
               [-146.51574874712298, 63.4871606275855],
               [-146.53737808061908, 63.48378873709511],
               [-146.5603807051308, 63.49267740866303],
               [-146.64449477983783, 63.49926550161952],
               [-146.63556838823627, 63.483635459894664]]],
             [[[-146.88958338066658, 61.35973440677904],
               [-146.8353383855494, 61.369441799206804],
               [-146.86108759209236, 61.386710218027346],
               [-146.8360250310572, 61.39345053564244],
               [-146.89850977226814, 61.41809784840907],
               [-146.91945246025642, 61.41136284791149],
               [-146.9736974553736, 61.42433874672317],
               [-147.02965906426033, 61.42548824977824],
               [-147.09248712822517, 61.423681868823444],
               [-147.08562067314705, 61.41464839551775],
               [-147.14089563652595, 61.40380477621934],
               [-147.1432988958033, 61.38358616323905],
               [-147.11342981621345, 61.37865280941431],
               [-147.08184412285408, 61.39936766475889],
               [-147.01008966728767, 61.40807695454616],
               [-146.9953267888697, 61.3985459082828],
               [-147.0166127996119, 61.388354331981006],
               [-146.93867853447517, 61.381448472162376],
               [-146.8912999944361, 61.375692423430415],
               [-146.88718012138924, 61.35989896394888]]],
             [[[-146.66779688164314, 61.42680191570815],
               [-146.64067438408455, 61.412019985092655],
               [-146.58162287041267, 61.39903896476237],
               [-146.5174215154322, 61.40971994445032],
               [-146.53493097588142, 61.44502332428168],
               [-146.59089258476814, 61.467990105637426],
               [-146.6489141301783, 61.45011028485157],
               [-146.74985101982674, 61.44567975293073],
               [-146.73817804619392, 61.42203961358263]]]]),
        {
          "system:index": "0",
          "class": "iceHigh"
        }),
    waterLakeProglacial = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -142.49048102100414,
                    61.60812299962469
                  ],
                  [
                    -142.48945105274242,
                    61.60004108039424
                  ],
                  [
                    -142.48756277759594,
                    61.5939986725335
                  ],
                  [
                    -142.4829279204182,
                    61.591303705307006
                  ],
                  [
                    -142.47022497852367,
                    61.59146704332576
                  ],
                  [
                    -142.46782171924633,
                    61.59546855587639
                  ],
                  [
                    -142.4612985869221,
                    61.60534762874613
                  ],
                  [
                    -142.46524679859203,
                    61.60559252441615
                  ],
                  [
                    -142.47073996265453,
                    61.601837244686436
                  ],
                  [
                    -142.48704779346508,
                    61.60420475668288
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -148.54292288291572,
                    61.28027994672262
                  ],
                  [
                    -148.541892914654,
                    61.27797020767803
                  ],
                  [
                    -148.49005117881416,
                    61.27912509844089
                  ],
                  [
                    -148.50618734824775,
                    61.298586864039194
                  ],
                  [
                    -148.55150595176337,
                    61.298751742686875
                  ],
                  [
                    -148.54292288291572,
                    61.27912509844089
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.99970628287514,
                    61.489076466683784
                  ],
                  [
                    -151.9943847801896,
                    61.48641335183472
                  ],
                  [
                    -151.98871995475014,
                    61.48725328188684
                  ],
                  [
                    -151.97515870597084,
                    61.48663870114662
                  ],
                  [
                    -151.98189641501625,
                    61.4888716197851
                  ],
                  [
                    -151.98996449973305,
                    61.49044890612716
                  ],
                  [
                    -151.9987621453019,
                    61.49005971302995
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -144.61639528473472,
                    60.807788086907706
                  ],
                  [
                    -144.61330537994957,
                    60.79706932748204
                  ],
                  [
                    -144.58927278717613,
                    60.79673430842816
                  ],
                  [
                    -144.56489687164878,
                    60.80728572521566
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -138.05286519672762,
                    60.28068510023187
                  ],
                  [
                    -138.0521785512198,
                    60.27293995787342
                  ],
                  [
                    -138.03329579975497,
                    60.27225897854104
                  ],
                  [
                    -138.01939122822176,
                    60.26314951730055
                  ],
                  [
                    -138.00153844501864,
                    60.25233406155282
                  ],
                  [
                    -137.99038045551669,
                    60.26093562037974
                  ],
                  [
                    -138.01097982075106,
                    60.27123748296611
                  ],
                  [
                    -138.0130397572745,
                    60.27991917885432
                  ],
                  [
                    -138.02557103779208,
                    60.284854801974525
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -153.7802480734954,
                    61.12679157027119
                  ],
                  [
                    -153.74625912085867,
                    61.131018709973105
                  ],
                  [
                    -153.75724544898367,
                    61.13955414990328
                  ],
                  [
                    -153.77956142798757,
                    61.14170836235571
                  ],
                  [
                    -153.79398098365164,
                    61.13565962364853
                  ],
                  [
                    -153.8142370261321,
                    61.1224809630831
                  ],
                  [
                    -153.80496731177664,
                    61.11717479304646
                  ],
                  [
                    -153.7841962851653,
                    61.122978370848685
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -140.822000970153,
                    59.78848173653038
                  ],
                  [
                    -140.83504723480144,
                    59.79435498607791
                  ],
                  [
                    -140.84122704437175,
                    59.78709964517552
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "system:index": "0",
          "class": "waterLakeProglacial"
        }),
    waterRiver = 
    /* color: #000000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-144.63169913920564, 60.85407721594001],
              [-144.61041312846345, 60.84571560261016],
              [-144.55410819682282, 60.83434029695368],
              [-144.52252250346345, 60.82781439802536],
              [-144.5142827573697, 60.81927852072299],
              [-144.50157981547517, 60.82111978494548],
              [-144.50569968852204, 60.83283443847073],
              [-144.509476238815, 60.84002845573106],
              [-144.5081029477994, 60.84738810031096],
              [-144.5146260801236, 60.85156896166737],
              [-144.51290946635407, 60.855080462518465],
              [-144.51874595317048, 60.85625087704478],
              [-144.52252250346345, 60.853575580837266],
              [-144.53522544535798, 60.85223784872577],
              [-144.56509452494782, 60.86109928046722],
              [-144.57711082133454, 60.855916477269645],
              [-144.61212974223298, 60.85173618474465],
              [-144.62139945658845, 60.85842439026804],
              [-144.63032584819, 60.86561264977833],
              [-144.64508872660798, 60.863773946679956]]]),
        {
          "system:index": "0",
          "class": "waterRiver"
        }),
    landWet = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -144.62485720515485,
                    60.73672414287577
                  ],
                  [
                    -144.60254122615095,
                    60.74544981490287
                  ],
                  [
                    -144.58383013606306,
                    60.74528203588577
                  ],
                  [
                    -144.56117083430524,
                    60.74939236930912
                  ],
                  [
                    -144.56511904597517,
                    60.75257961237813
                  ],
                  [
                    -144.5723288238072,
                    60.75241187063601
                  ],
                  [
                    -144.57644869685407,
                    60.755095633272894
                  ],
                  [
                    -144.56838061213728,
                    60.76574460285206
                  ],
                  [
                    -144.59807803035017,
                    60.771864063999764
                  ],
                  [
                    -144.6224539458775,
                    60.763900152642314
                  ],
                  [
                    -144.64219500422712,
                    60.75450857937964
                  ],
                  [
                    -144.6408217132115,
                    60.74486258450565
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.56277858279725,
                    61.348257368451364
                  ],
                  [
                    -151.51505672000428,
                    61.34973889500211
                  ],
                  [
                    -151.51231013797303,
                    61.37047290588605
                  ],
                  [
                    -151.60191737674256,
                    61.375736498967974
                  ],
                  [
                    -151.59402095340272,
                    61.35533514035226
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -152.68898766404823,
                    61.21259440878431
                  ],
                  [
                    -152.66323845750526,
                    61.21457831661274
                  ],
                  [
                    -152.6675299919291,
                    61.22614862070071
                  ],
                  [
                    -152.73035805589393,
                    61.23275831340114
                  ],
                  [
                    -152.7257231987162,
                    61.22639650923875
                  ],
                  [
                    -152.7070121086283,
                    61.22540494336876
                  ],
                  [
                    -152.6927642143412,
                    61.22003341851369
                  ],
                  [
                    -152.6908759391947,
                    61.21309039746251
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -135.4379730997524,
                    58.05001457284066
                  ],
                  [
                    -135.30888374428366,
                    58.0801605815232
                  ],
                  [
                    -135.3555756388149,
                    58.1128202751792
                  ],
                  [
                    -135.4214936075649,
                    58.10919289700248
                  ],
                  [
                    -135.40638740639304,
                    58.08742087572601
                  ],
                  [
                    -135.4695587931118,
                    58.064182734290746
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "system:index": "0",
          "class": "landWet"
        }),
    landFlood = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -143.2223592015447,
                    61.3551592886575
                  ],
                  [
                    -143.20708133899586,
                    61.35326654230919
                  ],
                  [
                    -143.19386341297047,
                    61.344459652111446
                  ],
                  [
                    -143.1754956456365,
                    61.332850526780184
                  ],
                  [
                    -143.16828586780446,
                    61.333509315715
                  ],
                  [
                    -143.14150669299977,
                    61.333097574254325
                  ],
                  [
                    -143.1215939732732,
                    61.326261875386564
                  ],
                  [
                    -143.1054578038396,
                    61.33441512787851
                  ],
                  [
                    -143.10837604724782,
                    61.34083740823641
                  ],
                  [
                    -143.09807636463063,
                    61.342648582550744
                  ],
                  [
                    -143.0934415074529,
                    61.35252587127508
                  ],
                  [
                    -143.11335422717946,
                    61.35450095508417
                  ],
                  [
                    -143.12554218494313,
                    61.35055066282809
                  ],
                  [
                    -143.12949039661305,
                    61.3541717831045
                  ],
                  [
                    -143.1215939732732,
                    61.35696963458185
                  ],
                  [
                    -143.0934415074529,
                    61.35441866241378
                  ],
                  [
                    -143.08297016345875,
                    61.35425407642398
                  ],
                  [
                    -143.07335712634938,
                    61.369474618185485
                  ],
                  [
                    -143.11163761340993,
                    61.3750673349254
                  ],
                  [
                    -143.14013340198414,
                    61.36832305234996
                  ],
                  [
                    -143.16073276721852,
                    61.371284135985775
                  ],
                  [
                    -143.1816754552068,
                    61.366924665409364
                  ],
                  [
                    -143.2007298680486,
                    61.371037389722936
                  ],
                  [
                    -143.22184421741383,
                    61.36544395227404
                  ],
                  [
                    -143.2208142491521,
                    61.35532386988708
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -134.36226793289472,
                    60.3248290456063
                  ],
                  [
                    -134.35780473709394,
                    60.30672190361218
                  ],
                  [
                    -134.31643434524824,
                    60.31326883654182
                  ],
                  [
                    -134.28381868362715,
                    60.32567889946937
                  ],
                  [
                    -134.2862219429045,
                    60.36203191398333
                  ],
                  [
                    -134.3011564826994,
                    60.36220169280383
                  ],
                  [
                    -134.302701435092,
                    60.34284121115631
                  ],
                  [
                    -134.33480211258222,
                    60.33893375555068
                  ],
                  [
                    -134.35179658890058,
                    60.34759748204095
                  ],
                  [
                    -134.37685914993574,
                    60.328823166410125
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -150.44531451252408,
                    61.59131078351512
                  ],
                  [
                    -150.42299853352017,
                    61.587227054185774
                  ],
                  [
                    -150.41166888264127,
                    61.596047235472625
                  ],
                  [
                    -150.41098223713345,
                    61.60747706807298
                  ],
                  [
                    -150.39896594074673,
                    61.613190403024085
                  ],
                  [
                    -150.40171252277798,
                    61.62526655547255
                  ],
                  [
                    -150.39450274494595,
                    61.64043666185015
                  ],
                  [
                    -150.40377245930142,
                    61.64320888795453
                  ],
                  [
                    -150.43879138019986,
                    61.63211849238675
                  ],
                  [
                    -150.44325457600064,
                    61.619881826255536
                  ],
                  [
                    -150.46934710529752,
                    61.61694430635009
                  ],
                  [
                    -150.43982134846158,
                    61.60388528939804
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -144.58167954298892,
                    61.65519248384422
                  ],
                  [
                    -144.5363609394733,
                    61.652584347881465
                  ],
                  [
                    -144.4601432881061,
                    61.64214960313729
                  ],
                  [
                    -144.48417588087955,
                    61.67051083881696
                  ],
                  [
                    -144.5919792256061,
                    61.69786941415705
                  ],
                  [
                    -144.6359245381061,
                    61.69331133521819
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "system:index": "0",
          "class": "landFlood"
        }),
    landHigh = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -143.8915267045162,
                    61.2678807196065
                  ],
                  [
                    -143.87779379435995,
                    61.27316156987833
                  ],
                  [
                    -143.90182638713338,
                    61.29625485158797
                  ],
                  [
                    -143.92036581584432,
                    61.314058062529064
                  ],
                  [
                    -143.94542837687948,
                    61.320154986705774
                  ],
                  [
                    -143.9794173295162,
                    61.31685949927462
                  ],
                  [
                    -143.98834372111776,
                    61.30614677202447
                  ],
                  [
                    -143.97083426066854,
                    61.30795995240613
                  ],
                  [
                    -143.92791891643026,
                    61.2904831239368
                  ],
                  [
                    -143.94474173137166,
                    61.288668933109896
                  ],
                  [
                    -143.93478537150838,
                    61.27910146513667
                  ],
                  [
                    -143.95126486369588,
                    61.27893648321869
                  ],
                  [
                    -143.9416518265865,
                    61.27184144055388
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -153.23419930892567,
                    61.713869733086085
                  ],
                  [
                    -153.29908730941395,
                    61.71956343042172
                  ],
                  [
                    -153.28810098128895,
                    61.69987503848371
                  ],
                  [
                    -153.26990487533192,
                    61.69987503848371
                  ],
                  [
                    -153.24896218734364,
                    61.690921613467324
                  ],
                  [
                    -153.23145272689442,
                    61.69499167417242
                  ],
                  [
                    -153.21051003890614,
                    61.69889842745345
                  ],
                  [
                    -153.20055367904286,
                    61.70638498867937
                  ],
                  [
                    -153.1699979539452,
                    61.70882586581496
                  ],
                  [
                    -153.1703412766991,
                    61.721352660986824
                  ],
                  [
                    -153.20124032455067,
                    61.729484218326576
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -135.86630194336692,
                    60.33260158034812
                  ],
                  [
                    -135.8455309167556,
                    60.33124209189288
                  ],
                  [
                    -135.8187517419509,
                    60.345259097775
                  ],
                  [
                    -135.78493445069114,
                    60.34135193176174
                  ],
                  [
                    -135.75952856690208,
                    60.359949250746425
                  ],
                  [
                    -135.76227514893333,
                    60.38388086749159
                  ],
                  [
                    -135.80896704346458,
                    60.39075159370681
                  ],
                  [
                    -135.84776251465598,
                    60.402793072715276
                  ],
                  [
                    -135.87419836670676,
                    60.390921222929876
                  ],
                  [
                    -135.87677328736106,
                    60.374038784235594
                  ],
                  [
                    -135.8649286523513,
                    60.36733428391105
                  ],
                  [
                    -135.86664526612083,
                    60.35239271529416
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -136.27188328237662,
                    61.29805348958211
                  ],
                  [
                    -136.23858097524771,
                    61.30299955615765
                  ],
                  [
                    -136.19806889028678,
                    61.326894552432
                  ],
                  [
                    -136.19566563100943,
                    61.344515735283856
                  ],
                  [
                    -136.24647739858756,
                    61.35044212905482
                  ],
                  [
                    -136.28286961050162,
                    61.340234864262115
                  ],
                  [
                    -136.31548527212271,
                    61.34764369401904
                  ],
                  [
                    -136.32887485952506,
                    61.31008755829833
                  ],
                  [
                    -136.28046635122428,
                    61.30679101239561
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -148.29028328776621,
                    62.521408479865094
                  ],
                  [
                    -148.29028328776621,
                    62.504453252569895
                  ],
                  [
                    -148.22814186930918,
                    62.506989226903116
                  ],
                  [
                    -148.1690903556373,
                    62.494941427811575
                  ],
                  [
                    -148.14299782634043,
                    62.50001477849881
                  ],
                  [
                    -148.09458931803965,
                    62.57300704079301
                  ],
                  [
                    -148.1302948844459,
                    62.57300704079301
                  ],
                  [
                    -148.20582589030528,
                    62.55813810431466
                  ],
                  [
                    -148.24359139323496,
                    62.52932817759041
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "system:index": "0",
          "class": "landHigh"
        }),
    landMud = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -142.33504169418927,
                    61.09062873951179
                  ],
                  [
                    -142.34534137680646,
                    61.10025359311828
                  ],
                  [
                    -142.37040393784162,
                    61.11037312486953
                  ],
                  [
                    -142.41160266831037,
                    61.117172957709215
                  ],
                  [
                    -142.42670886948224,
                    61.11219761384074
                  ],
                  [
                    -142.41537921860333,
                    61.10755325298484
                  ],
                  [
                    -142.42052905991193,
                    61.10158092933302
                  ],
                  [
                    -142.4411284251463,
                    61.10191275468287
                  ],
                  [
                    -142.45108478500958,
                    61.08531722184934
                  ],
                  [
                    -142.41503589584943,
                    61.07917466811323
                  ],
                  [
                    -142.39065998032208,
                    61.080502888847754
                  ],
                  [
                    -142.37349384262677,
                    61.0846532194542
                  ],
                  [
                    -142.34843128159162,
                    61.08598121031352
                  ],
                  [
                    -142.32783191635724,
                    61.087475133423716
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -152.07182668854148,
                    61.0544134872201
                  ],
                  [
                    -152.051570646061,
                    61.049012796909835
                  ],
                  [
                    -152.03165792633445,
                    61.050259191746335
                  ],
                  [
                    -152.04092764068992,
                    61.058484168463224
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.9875409524575,
                    61.065129054829505
                  ],
                  [
                    -152.00230383087546,
                    61.07177254747911
                  ],
                  [
                    -152.0237615029946,
                    61.070360921895826
                  ],
                  [
                    -152.00848364044577,
                    61.06554431394953
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -138.57346540884487,
                    59.121081843818374
                  ],
                  [
                    -138.5140705724191,
                    59.114737984957294
                  ],
                  [
                    -138.51853376821987,
                    59.13253305904239
                  ],
                  [
                    -138.56007582144252,
                    59.136055739768935
                  ],
                  [
                    -138.55011946157924,
                    59.12390095967323
                  ],
                  [
                    -138.57106214956752,
                    59.12037702860858
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -148.56342899448816,
                    61.42118425993251
                  ],
                  [
                    -148.55690586216394,
                    61.4384241029302
                  ],
                  [
                    -148.59158146030848,
                    61.444660936874826
                  ],
                  [
                    -148.59089481480066,
                    61.42808134026947
                  ],
                  [
                    -148.60119449741785,
                    61.42282656018168
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "class": "landMud",
          "system:index": "0"
        }),
    landCliff = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -143.61190092549577,
                    61.75293615168534
                  ],
                  [
                    -143.6194540260817,
                    61.74383559559439
                  ],
                  [
                    -143.62323057637468,
                    61.73782125224858
                  ],
                  [
                    -143.63078367696062,
                    61.72822838297012
                  ],
                  [
                    -143.63387358174577,
                    61.7259516703997
                  ],
                  [
                    -143.6304403542067,
                    61.723349507202336
                  ],
                  [
                    -143.63627684102312,
                    61.72253628614436
                  ],
                  [
                    -143.63936674580827,
                    61.725301150198234
                  ],
                  [
                    -143.65618956074968,
                    61.71505364558432
                  ],
                  [
                    -143.67060911641374,
                    61.70366353327919
                  ],
                  [
                    -143.6565328835036,
                    61.703338039680496
                  ],
                  [
                    -143.65344297871843,
                    61.7069182803644
                  ],
                  [
                    -143.6414266823317,
                    61.71619242544737
                  ],
                  [
                    -143.62151396260515,
                    61.72416270680344
                  ],
                  [
                    -143.60640776143327,
                    61.73782125224858
                  ],
                  [
                    -143.58924162373796,
                    61.75667310083753
                  ],
                  [
                    -143.5967947243239,
                    61.75846017701224
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -143.75425219291662,
                    62.16228142682666
                  ],
                  [
                    -143.74326586479162,
                    62.111577548310485
                  ],
                  [
                    -143.71785998100256,
                    62.12281673945855
                  ],
                  [
                    -143.73227953666662,
                    62.13533550179337
                  ],
                  [
                    -143.72747301811194,
                    62.152660635311946
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -142.36948464895255,
                    60.60715432163549
                  ],
                  [
                    -142.3729178764916,
                    60.600076500386606
                  ],
                  [
                    -142.32416604543693,
                    60.59839107610187
                  ],
                  [
                    -142.2733542778588,
                    60.600750645464856
                  ],
                  [
                    -142.1751639702416,
                    60.59097416392142
                  ],
                  [
                    -142.17722390676505,
                    60.598053980686586
                  ],
                  [
                    -142.2623679497338,
                    60.60749132203363
                  ],
                  [
                    -142.3344657280541,
                    60.60277299623712
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -140.96526335275558,
                    60.8794041437561
                  ],
                  [
                    -140.95908354318527,
                    60.866035118689446
                  ],
                  [
                    -140.89316557443527,
                    60.86302631648594
                  ],
                  [
                    -140.82244108713058,
                    60.84864701526035
                  ],
                  [
                    -140.78398893869308,
                    60.83794193916727
                  ],
                  [
                    -140.7304305890837,
                    60.839614843639445
                  ],
                  [
                    -140.67893217599777,
                    60.83827652706466
                  ],
                  [
                    -140.63292692697433,
                    60.82288185931171
                  ],
                  [
                    -140.58486174142746,
                    60.819534211745804
                  ],
                  [
                    -140.58348845041183,
                    60.827567977460895
                  ],
                  [
                    -140.6418533185759,
                    60.832588056582765
                  ],
                  [
                    -140.72150419748215,
                    60.847978053034936
                  ],
                  [
                    -140.78879545724777,
                    60.84764356667108
                  ],
                  [
                    -140.85196684396652,
                    60.86068594101531
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "system:index": "0",
          "class": "landCliff"
        }),
    waterBlueLake = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.49624402457562,
                    61.82464100567068
                  ],
                  [
                    -146.44989545279827,
                    61.84181956845205
                  ],
                  [
                    -146.48869092398968,
                    61.8651410780537
                  ],
                  [
                    -146.52439649039593,
                    61.84230561422966
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -152.48281249045198,
                    61.21419618024484
                  ],
                  [
                    -152.5549102687723,
                    61.218494270494986
                  ],
                  [
                    -152.5387740993387,
                    61.20625970240789
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.601291663011,
                    61.38994030807664
                  ],
                  [
                    -151.5738258426985,
                    61.395364995234
                  ],
                  [
                    -151.62017441447585,
                    61.40654016918491
                  ],
                  [
                    -151.6218910282454,
                    61.39289934508692
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -140.20333336761394,
                    59.79504588863048
                  ],
                  [
                    -140.17037438323894,
                    59.829572773302004
                  ],
                  [
                    -140.24315880706706,
                    59.818182855166484
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "system:index": "0",
          "class": "waterBlueLake"
        }),
    waterGreenLake = 
    /* color: #000000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-146.04640426602998, 61.875952741762696],
              [-146.0445159908835, 61.86875018441809],
              [-146.03430213895479, 61.87166378239373],
              [-146.03550376859346, 61.87833973254754],
              [-146.048206710488, 61.887521843510214],
              [-146.0525840756003, 61.87850155569648]]]),
        {
          "system:index": "0",
          "class": "waterGreenLake"
        }),
    waterLakeNonglacial = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.55310205109265,
                    62.3601692021243
                  ],
                  [
                    -146.59876397736218,
                    62.35881536346655
                  ],
                  [
                    -146.61524346954968,
                    62.3375441175305
                  ],
                  [
                    -146.56288674957898,
                    62.317613553782444
                  ],
                  [
                    -146.50984338410046,
                    62.34152864396986
                  ],
                  [
                    -146.54257641696938,
                    62.352898252423294
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -145.6119424931403,
                    62.412740081757356
                  ],
                  [
                    -145.6002695195075,
                    62.41591976116351
                  ],
                  [
                    -145.6012994877692,
                    62.41957597496622
                  ],
                  [
                    -145.61331578415593,
                    62.418463261523165
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.02461644333562,
                    62.39238213443512
                  ],
                  [
                    -146.0283929936286,
                    62.38363032787879
                  ],
                  [
                    -146.00607701462468,
                    62.38792698864835
                  ],
                  [
                    -146.00813695114812,
                    62.39556397591659
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -138.47252472135074,
                    61.07501548550679
                  ],
                  [
                    -138.44196899625308,
                    61.078336369109536
                  ],
                  [
                    -138.4656582662726,
                    61.097092818422794
                  ],
                  [
                    -138.49381073209292,
                    61.085973079531904
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -155.17303424716965,
                    59.52576569836466
                  ],
                  [
                    -155.09956317783372,
                    59.51218188176297
                  ],
                  [
                    -155.0362433857823,
                    59.57902828804384
                  ],
                  [
                    -155.12482065629013,
                    59.554681704226766
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -142.752851420098,
                    63.07484752456311
                  ],
                  [
                    -142.72366898601598,
                    63.08883605825457
                  ],
                  [
                    -142.7799739176566,
                    63.095517094441206
                  ],
                  [
                    -142.76143448894567,
                    63.07904479097299
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -133.71603629370753,
                    59.52284590594232
                  ],
                  [
                    -133.69955680152003,
                    59.54095071955398
                  ],
                  [
                    -133.75380179663722,
                    59.54895551636237
                  ],
                  [
                    -133.74281546851222,
                    59.52806944634544
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "system:index": "0",
          "class": "waterLakeNonglacial"
        }),
    waterBrownLake = 
    /* color: #000000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-144.57227248250263, 60.66017150825735],
              [-144.57913893758075, 60.674467392541736],
              [-144.59081191121356, 60.6621901355789],
              [-144.6031715303542, 60.66269477263877],
              [-144.60797804890888, 60.674299242566576],
              [-144.6210243135573, 60.667236150325586],
              [-144.63235396443622, 60.67598070278836],
              [-144.67183608113544, 60.67379478737032],
              [-144.7199012666823, 60.676989536756935],
              [-144.7240211397292, 60.664040432803716],
              [-144.69586867390888, 60.65596562825709],
              [-144.66737288533466, 60.65966683165602],
              [-144.63441390095966, 60.658825686412506],
              [-144.61896437703388, 60.65007647350858],
              [-144.58943862019794, 60.657984519200376]]]),
        {
          "system:index": "0",
          "class": "waterBrownLake"
        }),
    debrisSupraglacialDry = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -141.07797083979608,
                    60.84631924088102
                  ],
                  [
                    -141.0628646386242,
                    60.848660668933626
                  ],
                  [
                    -141.0903304589367,
                    60.85568392391239
                  ],
                  [
                    -141.14251551753046,
                    60.87173128220004
                  ],
                  [
                    -141.18714747553827,
                    60.884095618581
                  ],
                  [
                    -141.1665481103039,
                    60.86939154462051
                  ],
                  [
                    -141.12740931635858,
                    60.854011860362654
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -150.49209142953146,
                    62.70469417507015
                  ],
                  [
                    -150.4812767627834,
                    62.69414382443874
                  ],
                  [
                    -150.4773285511135,
                    62.6790991310405
                  ],
                  [
                    -150.44042135506857,
                    62.68075363393555
                  ],
                  [
                    -150.44333959847677,
                    62.69453756184233
                  ],
                  [
                    -150.45157934457052,
                    62.706583392700125
                  ],
                  [
                    -150.47818685799825,
                    62.71468991434933
                  ],
                  [
                    -150.49535299569357,
                    62.713430794699214
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.81309763427583,
                    62.667828404720574
                  ],
                  [
                    -151.81206766601412,
                    62.64512010365073
                  ],
                  [
                    -151.76091257568208,
                    62.665621416984386
                  ],
                  [
                    -151.71559397216646,
                    62.680436608390025
                  ],
                  [
                    -151.73859659667818,
                    62.68421802251882
                  ],
                  [
                    -151.74855295654146,
                    62.69193690958881
                  ],
                  [
                    -151.76297251220552,
                    62.68059417695861
                  ],
                  [
                    -151.78185526367037,
                    62.68059417695861
                  ],
                  [
                    -151.79249826904146,
                    62.668458942436466
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -150.1342695958058,
                    63.02908250137649
                  ],
                  [
                    -150.05290210313,
                    62.999950192864624
                  ],
                  [
                    -149.9814909703175,
                    62.964703323838016
                  ],
                  [
                    -149.94063556260267,
                    62.970164692797084
                  ],
                  [
                    -150.00483691758313,
                    63.00493746391805
                  ],
                  [
                    -150.06079852646985,
                    63.02752536003091
                  ],
                  [
                    -150.07144153184095,
                    63.03966885741872
                  ],
                  [
                    -150.06148517197767,
                    63.06083003835011
                  ],
                  [
                    -150.08826434678235,
                    63.06487380814498
                  ],
                  [
                    -150.10028064316907,
                    63.02923821093746
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -141.05137503787466,
                    59.920285817677374
                  ],
                  [
                    -140.96829093142935,
                    59.92682401869474
                  ],
                  [
                    -140.9099260632653,
                    59.96362036372355
                  ],
                  [
                    -140.88452017947623,
                    59.98286198754948
                  ],
                  [
                    -141.05000174685904,
                    59.97324257317308
                  ],
                  [
                    -141.13720572635123,
                    59.97702196213201
                  ],
                  [
                    -141.13789237185904,
                    59.93852074227896
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -142.85149460573382,
                    62.09851358304733
                  ],
                  [
                    -142.8563011242885,
                    62.120355316474765
                  ],
                  [
                    -142.86831742067523,
                    62.10509987978719
                  ],
                  [
                    -142.88102036256976,
                    62.07344045221205
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "system:index": "0",
          "class": "debrisSupraglacial"
        }),
    iceGreyGlacial = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -141.4935630333996,
                    60.768285197301665
                  ],
                  [
                    -141.4903014672375,
                    60.76141043381978
                  ],
                  [
                    -141.47794184809686,
                    60.77272785788382
                  ],
                  [
                    -141.4686721337414,
                    60.78395749938384
                  ],
                  [
                    -141.45957408076288,
                    60.793340450036844
                  ],
                  [
                    -141.45425257807733,
                    60.7972771197229
                  ],
                  [
                    -141.45270762568475,
                    60.80142266358997
                  ],
                  [
                    -141.45682749873163,
                    60.80100394615177
                  ],
                  [
                    -141.46798548823358,
                    60.79112062507485
                  ],
                  [
                    -141.4708179009533,
                    60.79195831294441
                  ],
                  [
                    -141.4609473717785,
                    60.801171433784106
                  ],
                  [
                    -141.46858630305292,
                    60.802008858804705
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -140.47249840667644,
                    59.866476944772224
                  ],
                  [
                    -140.4312996762077,
                    59.953573691201704
                  ],
                  [
                    -140.5974678890983,
                    59.94085048380805
                  ],
                  [
                    -140.61532067230144,
                    59.885774969459405
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -143.4906159971202,
                    60.23793832743241
                  ],
                  [
                    -143.4205781553233,
                    60.2236194859509
                  ],
                  [
                    -143.39997879008894,
                    60.278814842103614
                  ],
                  [
                    -143.425384673878,
                    60.31283962913541
                  ],
                  [
                    -143.480316314503,
                    60.26689779749736
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -147.4482487084448,
                    61.542873200752105
                  ],
                  [
                    -147.44395717402097,
                    61.551951320802516
                  ],
                  [
                    -147.47760280390378,
                    61.56020928597611
                  ],
                  [
                    -147.4899624230444,
                    61.57761739690452
                  ],
                  [
                    -147.49459728022214,
                    61.57704545460531
                  ],
                  [
                    -147.48876079340573,
                    61.55203309360389
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.30792805349154,
                    62.77275800952546
                  ],
                  [
                    -151.31273457204622,
                    62.74289821453236
                  ],
                  [
                    -151.32646748220247,
                    62.73440622962259
                  ],
                  [
                    -151.29694172536654,
                    62.73880978596052
                  ],
                  [
                    -151.25230976735872,
                    62.82831095266655
                  ],
                  [
                    -151.2790889421634,
                    62.83364103099604
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.88859016930337,
                    61.44684477240779
                  ],
                  [
                    -151.85940773522134,
                    61.439131151149034
                  ],
                  [
                    -151.84533150231118,
                    61.44996250326883
                  ],
                  [
                    -151.9177726033854,
                    61.462102272914095
                  ],
                  [
                    -151.99673683678384,
                    61.47046611871889
                  ],
                  [
                    -152.032785725944,
                    61.47456522302332
                  ],
                  [
                    -151.96824104820962,
                    61.45586892780372
                  ],
                  [
                    -151.8961432698893,
                    61.44897799036434
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -150.38166164510994,
                    59.994993637087376
                  ],
                  [
                    -150.29308437460213,
                    59.96785591266271
                  ],
                  [
                    -150.2748882686451,
                    59.975415488709274
                  ],
                  [
                    -150.33325313680916,
                    59.995508695146135
                  ],
                  [
                    -150.43762325399666,
                    60.036344424992
                  ],
                  [
                    -150.440026513274,
                    60.020393610336924
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -143.14018759487396,
                    61.90205515716881
                  ],
                  [
                    -143.06328329799896,
                    61.89235172457863
                  ],
                  [
                    -143.03856405971771,
                    61.94955751198077
                  ],
                  [
                    -142.95685324428803,
                    61.978281570608715
                  ],
                  [
                    -143.00217184780365,
                    62.00633401637671
                  ],
                  [
                    -143.08937582729584,
                    61.9702157458272
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -134.16581201312465,
                    59.04037517646577
                  ],
                  [
                    -134.16752862689418,
                    59.02818645191913
                  ],
                  [
                    -134.10092401263637,
                    59.02836313096166
                  ],
                  [
                    -134.10367059466762,
                    58.98805681303541
                  ],
                  [
                    -134.05526208636684,
                    58.982219092612425
                  ],
                  [
                    -134.0429024672262,
                    59.03525290561709
                  ],
                  [
                    -134.01303338763637,
                    59.04849859235014
                  ],
                  [
                    -134.0477089857809,
                    59.065445623652856
                  ],
                  [
                    -134.06693505999965,
                    59.07744471264186
                  ],
                  [
                    -134.04976892230434,
                    59.08644127733286
                  ],
                  [
                    -134.09028100726528,
                    59.09525914924521
                  ],
                  [
                    -134.135256288027,
                    59.08908687691179
                  ],
                  [
                    -134.08822107074184,
                    59.06703397918851
                  ],
                  [
                    -134.1139702772848,
                    59.0396687017269
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "class": "iceGreyGlacial",
          "system:index": "0"
        }),
    iceWhiteGlacial = 
    /* color: #000000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-140.9988724246507, 61.1546377804083],
              [-140.9992157474046, 61.14834301738207],
              [-140.97518315463117, 61.1667268294257],
              [-140.96351018099836, 61.179473272902165],
              [-140.9549271121507, 61.19287630933488],
              [-140.94531407504132, 61.195853987871274],
              [-140.95046391634992, 61.200154582274735],
              [-140.96282353549054, 61.19271087449775],
              [-140.98445286898664, 61.165898960135415]]]),
        {
          "system:index": "0",
          "class": "iceWhiteGlacial"
        }),
    snowHigh = 
    /* color: #000000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry.Polygon(
            [[[-141.2583209279785, 61.183191232915995],
              [-141.25694763696288, 61.176074563796],
              [-141.22707855737303, 61.183191232915995],
              [-141.2140322927246, 61.17706768384156],
              [-141.22776520288085, 61.17044629263306],
              [-141.20201599633788, 61.16779734682405],
              [-141.1982394460449, 61.17342609073779],
              [-141.17420685327147, 61.17408822985779],
              [-141.1707736257324, 61.18219830576166],
              [-141.20235931909178, 61.183687684764195],
              [-141.20510590112303, 61.18898268463323],
              [-141.20201599633788, 61.199239215581436],
              [-141.22330200708006, 61.20635065538816],
              [-141.22845184838866, 61.19576560322073]]]),
        {
          "system:index": "0",
          "class": "snowHigh"
        }),
    iceHighShadow = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -141.2201973817398,
                    61.264809139143
                  ],
                  [
                    -141.21024102187653,
                    61.26612956406544
                  ],
                  [
                    -141.2136742494156,
                    61.26827513619054
                  ],
                  [
                    -141.2256905458023,
                    61.2656344112237
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -141.2689492127945,
                    61.27982569790613
                  ],
                  [
                    -141.2641426942398,
                    61.277680914824664
                  ],
                  [
                    -141.25075310683746,
                    61.27801089098929
                  ],
                  [
                    -141.25967949843903,
                    61.280485601685385
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -141.19582146621246,
                    61.312309481969294
                  ],
                  [
                    -141.18449181533356,
                    61.312309481969294
                  ],
                  [
                    -141.18929833388825,
                    61.31494628230971
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -141.5824028871109,
                    61.368787327004924
                  ],
                  [
                    -141.5659233949234,
                    61.367964766231694
                  ],
                  [
                    -141.56695336318512,
                    61.370267881887784
                  ],
                  [
                    -141.5817162416031,
                    61.370267881887784
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -141.44404381728668,
                    61.40019295696088
                  ],
                  [
                    -141.4337441346695,
                    61.39822075720611
                  ],
                  [
                    -141.4289376161148,
                    61.40216503221111
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -141.50069207168121,
                    61.399371222194134
                  ],
                  [
                    -141.4883324525406,
                    61.39624843294123
                  ],
                  [
                    -141.4728829286148,
                    61.398549465811605
                  ],
                  [
                    -141.47082299209137,
                    61.404629951197734
                  ],
                  [
                    -141.48249596572418,
                    61.399371222194134
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.02759435535876,
                    62.979758338351616
                  ],
                  [
                    -151.01248815418688,
                    62.97960236460597
                  ],
                  [
                    -151.00459173084704,
                    62.97819856342791
                  ],
                  [
                    -150.99291875721423,
                    62.9789784612974
                  ],
                  [
                    -150.98467901112048,
                    62.984749058620935
                  ],
                  [
                    -150.99291875721423,
                    62.985684723764514
                  ],
                  [
                    -151.00562169910876,
                    62.98147399460329
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.14123418690173,
                    62.94823473473517
                  ],
                  [
                    -151.11411168934313,
                    62.950889021197284
                  ],
                  [
                    -151.10827520252673,
                    62.958226089506645
                  ],
                  [
                    -151.08630254627673,
                    62.96337654846433
                  ],
                  [
                    -151.10037877918688,
                    62.969150226827594
                  ],
                  [
                    -151.1120517528197,
                    62.960567319668954
                  ],
                  [
                    -151.12750127674548,
                    62.953230838694914
                  ],
                  [
                    -151.14775731922595,
                    62.949796108875866
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -150.85725771127625,
                    62.97258268426439
                  ],
                  [
                    -150.85279451547547,
                    62.968526100351795
                  ],
                  [
                    -150.83974825082703,
                    62.97102252630536
                  ],
                  [
                    -150.82532869516297,
                    62.983033594686184
                  ],
                  [
                    -150.82910524545593,
                    62.98506095033204
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -150.89570985971375,
                    63.066263005209976
                  ],
                  [
                    -150.8823202723114,
                    63.06486336909382
                  ],
                  [
                    -150.87270723520203,
                    63.07061699835664
                  ],
                  [
                    -150.87270723520203,
                    63.074970340255234
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -151.02224264716278,
                    63.09776581572926
                  ],
                  [
                    -150.99100027655732,
                    63.10289168504311
                  ],
                  [
                    -150.98070059394013,
                    63.11329597270394
                  ],
                  [
                    -150.96559439276825,
                    63.12555892967021
                  ],
                  [
                    -150.98894034003388,
                    63.13642051496746
                  ],
                  [
                    -151.02567587470185,
                    63.139057715245606
                  ],
                  [
                    -151.06859121894013,
                    63.111432792049875
                  ],
                  [
                    -151.06275473212372,
                    63.10413418390548
                  ],
                  [
                    -151.03013907050263,
                    63.0993192049166
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -152.47742897285121,
                    61.53899007231542
                  ],
                  [
                    -152.48120552314418,
                    61.53530853686441
                  ],
                  [
                    -152.4909902216305,
                    61.53449035861562
                  ],
                  [
                    -152.4957967401852,
                    61.54062617023188
                  ],
                  [
                    -152.51244789374965,
                    61.54888714815709
                  ],
                  [
                    -152.52463585151332,
                    61.54995028270476
                  ],
                  [
                    -152.51124626411098,
                    61.5410351812441
                  ],
                  [
                    -152.50231987250942,
                    61.54119878414072
                  ],
                  [
                    -152.50077492011684,
                    61.53858103436917
                  ],
                  [
                    -152.5045514704098,
                    61.535635802130045
                  ],
                  [
                    -152.4906468988766,
                    61.52966266828762
                  ],
                  [
                    -152.4800038935055,
                    61.53170839137461
                  ],
                  [
                    -152.4763990045895,
                    61.53530853686441
                  ],
                  [
                    -152.47193580878871,
                    61.535717617907736
                  ],
                  [
                    -152.45631462348598,
                    61.53890826515711
                  ],
                  [
                    -152.4544263483395,
                    61.54177138749176
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -152.28133210938608,
                    61.5084143196124
                  ],
                  [
                    -152.2787571887318,
                    61.51070708716456
                  ],
                  [
                    -152.27343568604624,
                    61.51357280889054
                  ],
                  [
                    -152.2820187548939,
                    61.51455528125346
                  ],
                  [
                    -152.28322038453257,
                    61.51209904213377
                  ],
                  [
                    -152.30055818360483,
                    61.51168965008174
                  ],
                  [
                    -152.2871685962025,
                    61.50997014460115
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -152.32544908326304,
                    61.55072138744613
                  ],
                  [
                    -152.31944093506968,
                    61.55268395298381
                  ],
                  [
                    -152.32733735840952,
                    61.555300514028325
                  ],
                  [
                    -152.33557710450327,
                    61.55407402850255
                  ],
                  [
                    -152.33832368653452,
                    61.54695945666992
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.44506701963826,
                    61.37029486698258
                  ],
                  [
                    -146.45502337950154,
                    61.37029486698258
                  ],
                  [
                    -146.4697862579195,
                    61.37325576395325
                  ],
                  [
                    -146.46017322081013,
                    61.36700465268429
                  ],
                  [
                    -146.45090350645467,
                    61.3665110906887
                  ],
                  [
                    -146.43957385557576,
                    61.369636851810036
                  ],
                  [
                    -146.44335040586873,
                    61.37769658384335
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.5401674224703,
                    61.31991671378164
                  ],
                  [
                    -146.5518403961031,
                    61.317445111901556
                  ],
                  [
                    -146.56454333799763,
                    61.31365494380986
                  ],
                  [
                    -146.53192767637654,
                    61.31892809641687
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.5092630260658,
                    61.38336308235941
                  ],
                  [
                    -146.51544283563612,
                    61.38138982016606
                  ],
                  [
                    -146.51681612665175,
                    61.37744292210225
                  ],
                  [
                    -146.50411318475722,
                    61.382705342134315
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.37815616068394,
                    61.33991420679363
                  ],
                  [
                    -146.38364932474644,
                    61.33843221529285
                  ],
                  [
                    -146.3754095786527,
                    61.33530333625952
                  ],
                  [
                    -146.36716983255894,
                    61.3369501536611
                  ],
                  [
                    -146.37163302835972,
                    61.33991420679363
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.17734553602162,
                    61.31815537413624
                  ],
                  [
                    -146.16807582166615,
                    61.32425150143859
                  ],
                  [
                    -146.1704790809435,
                    61.32985230277543
                  ],
                  [
                    -146.1660158851427,
                    61.340556930909386
                  ],
                  [
                    -146.1766588905138,
                    61.33001701707123
                  ],
                  [
                    -146.17288234022084,
                    61.323922011358434
                  ],
                  [
                    -146.18009211805287,
                    61.31963832504844
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -143.08205848722912,
                    61.73610216465206
                  ],
                  [
                    -143.075192032151,
                    61.73593958945793
                  ],
                  [
                    -143.10540443449474,
                    61.73902837142772
                  ],
                  [
                    -143.12085395842053,
                    61.73642731246626
                  ],
                  [
                    -143.09991127043224,
                    61.733500858581145
                  ],
                  [
                    -143.07965522795178,
                    61.736264738988176
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -142.75804842059847,
                    61.76073679748448
                  ],
                  [
                    -142.75186861102816,
                    61.76073679748448
                  ],
                  [
                    -142.74465883319613,
                    61.76463522417868
                  ],
                  [
                    -142.72886598651644,
                    61.76593458998674
                  ],
                  [
                    -142.73985231464144,
                    61.76837075297132
                  ],
                  [
                    -142.75221193378206,
                    61.76236120196522
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -142.83387406095653,
                    61.845746919810786
                  ],
                  [
                    -142.81121475919872,
                    61.84833874298102
                  ],
                  [
                    -142.79816849455028,
                    61.85335977693994
                  ],
                  [
                    -142.7830622933784,
                    61.85335977693994
                  ],
                  [
                    -142.80160172208934,
                    61.85433149497934
                  ],
                  [
                    -142.8153346322456,
                    61.84866270547275
                  ],
                  [
                    -142.82975418790966,
                    61.84752882177525
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "system:index": "0",
          "class": "iceHighShadow"
        }),
    fullRegion = 
    /* color: #d6d6d6 */
    /* shown: false */
    ee.Geometry.MultiPoint(),
    area3 = 
    /* color: #02d6af */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-150.57714880274455, 63.42229417482945],
          [-150.57714880274455, 62.89462711823349],
          [-149.88089025782267, 62.89462711823349],
          [-149.88089025782267, 63.42229417482945]]], null, false),
    area1 = 
    /* color: #00d64c */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-145.32276926447548, 61.07165506676429],
          [-145.32276926447548, 60.569510029361496],
          [-144.29966745783486, 60.569510029361496],
          [-144.29966745783486, 61.07165506676429]]], null, false),
    area2 = 
    /* color: #98ff00 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-143.14620274883362, 62.21636054886273],
          [-143.14620274883362, 61.41340232908033],
          [-142.39638585430237, 61.41340232908033],
          [-142.39638585430237, 62.21636054886273]]], null, false),
    dem = ee.Image("users/hengstam/mergedDEM"),
    area4 = 
    /* color: #bfd604 */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-150.72293077076253, 63.47055459955244],
          [-150.72293077076253, 59.69038930734772],
          [-139.84646592701256, 59.69038930734772],
          [-139.84646592701256, 63.47055459955244]]], null, false),
    debrisSupraglacialWet = ee.FeatureCollection("users/hengstam/wetDebris"),
    waterLakeMurky = 
    /* color: #1056d6 */
    /* shown: false */
    ee.Feature(
        ee.Geometry({
          "type": "GeometryCollection",
          "geometries": [
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.46611460506188,
                    61.72708026616803
                  ],
                  [
                    -146.45100840389,
                    61.718622742146486
                  ],
                  [
                    -146.43504389583336,
                    61.72886906040617
                  ],
                  [
                    -146.461994732015,
                    61.731389457860615
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -146.41392954646813,
                    61.73415352769217
                  ],
                  [
                    -146.41307123958336,
                    61.73130815793491
                  ],
                  [
                    -146.40912302791344,
                    61.73057644894981
                  ],
                  [
                    -146.40912302791344,
                    61.73512902254337
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -143.87240405015405,
                    60.278310118508486
                  ],
                  [
                    -143.89986987046655,
                    60.257026307838935
                  ],
                  [
                    -143.8590144627517,
                    60.267755078698904
                  ],
                  [
                    -143.86176104478295,
                    60.27354374800622
                  ],
                  [
                    -143.85592455796655,
                    60.2829056038095
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -143.0554366400968,
                    60.28471552573217
                  ],
                  [
                    -143.05569413216222,
                    60.279864985214736
                  ],
                  [
                    -143.02694085152257,
                    60.27641811134013
                  ],
                  [
                    -143.0249667456876,
                    60.280077743304595
                  ]
                ]
              ],
              "evenOdd": true
            },
            {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -144.59439469574002,
                    60.65951467029905
                  ],
                  [
                    -144.57379533050565,
                    60.65699115673983
                  ],
                  [
                    -144.56246567962674,
                    60.66590668645783
                  ],
                  [
                    -144.57757188079862,
                    60.67431530111706
                  ],
                  [
                    -144.5933647274783,
                    60.67717372980159
                  ],
                  [
                    -144.61259080169705,
                    60.67448345100834
                  ],
                  [
                    -144.64074326751737,
                    60.67061578125426
                  ],
                  [
                    -144.6263237118533,
                    60.654299191006125
                  ]
                ]
              ],
              "geodesic": true,
              "evenOdd": true
            }
          ],
          "coordinates": []
        }),
        {
          "class": "waterLakeMurky",
          "system:index": "0"
        }),
    area1_truthLakes = ee.FeatureCollection("users/hengstam/area1_truthLakes"),
    area2_truthLakes = ee.FeatureCollection("users/hengstam/area2_truthLakes"),
    area3_truthLakes = ee.FeatureCollection("users/hengstam/area3_truthLakes"),
    AKHydroStreams = ee.FeatureCollection("users/hengstam/AKHydroStreams"),
    jaxa_dem = ee.Image("JAXA/ALOS/AW3D30/V2_2"),
    area123_merge = ee.FeatureCollection("users/hengstam/area123_merge_areaBoundary"),
    area123_merge_truthLakes = ee.FeatureCollection("users/hengstam/area123_merge_truthLakes"),
    imageVisParam = {"opacity":1,"bands":["MNDWI"],"min":0.0043859649122807015,"max":1.0482456140350878,"gamma":1},
    jabBuffer = ee.FeatureCollection("users/hengstam/jabBuffer");
    
    
    var generation = 'Jabberwocky';

function classify(opt) {
  // Select some number of points from each training dataset
  function makeSampler () {
    var classIndex = 0;
    return function sample (region) {
      // Yes, this starts indexing from one. Yes, it's supposed to. We do some tricks that involve
      // multiplying out-of-range values by 0, so all valid classes need to have an index > 0.
      classIndex += 1; 
      return ee.Feature(
        ee.FeatureCollection
          .randomPoints({
            region: region.geometry(), 
            points: opt.classifier.samples,
          }).geometry())
      .set('class', classIndex);
    };
  }
  // This is the set of pixels pulled in equal number from each training class. They do not 
  // yet contain the spectral data used to train the classifier, this is only the geometries.
  var representativePixels = ee.FeatureCollection(opt.classifier.trainingClasses.map(makeSampler()));
  // This function returns satellite imagery with the requested bands (in opt.classifier.bands) 
  // after normalization.
  function getImagery(y, m1, m2) {
    // This factory function returns a function that normalizes data on a given multi-band image.
    function makeNormalizer(img) {
      // We use representativePixels to sample the raster values & develop a rough distribution. From 
      // these values, we'll normalize all band values to [0, 1] with a 0.5 margin (values in the 0.5%
      // through 99.5% percentiles). This is why we define representativePixels above rather than much
      // lower down where we train the classifier. They have two roles. 
      // EDIT: ignore that, we're just doing the whole entire range from 0-100%.
      return function normalize(band) {
        var lim = 0;
        var imgBand = img.select(band)
        var minMax = imgBand.reduceRegion({
          reducer: ee.Reducer.percentile([lim, 100-lim], ['1', '2']),
          geometry: representativePixels.geometry(),
          scale: opt.proj.scale,
          maxPixels: 10e6,
          bestEffort: true,
        }).values();
        return imgBand.unitScale(ee.Number(minMax.get(0)), ee.Number(minMax.get(1)));
      };
    }
    // This function generates the local variance maps.
    function localVariance (data, lvr) {
      var out = data.reduceNeighborhood({
        reducer: ee.Reducer.stdDev(), 
        kernel: ee.Kernel.circle({radius: lvr})
      });
      return out.reproject(opt.proj);
    }
    // Obtain the Sentinel-2 composite (using the Landsat .
    var imagery = ee.Algorithms.Landsat.simpleComposite(
      ee.ImageCollection("LANDSAT/LC08/C01/T1")
        .filter(ee.Filter.calendarRange(y, y, 'year'))
        .filter(ee.Filter.calendarRange(m1, m2, 'month'))
      ).toFloat();
      
    // Put all bands in (note the names they use).
    imagery = imagery.addBands(
      ee.Image([
        imagery.normalizedDifference(['B3', 'B5']).rename("MNDWI"),
        imagery.normalizedDifference(['B5', 'B4']).rename("NDVI"),
        localVariance(imagery.select('B5'), 1).rename("B5LVR1"),
        localVariance(imagery.select('B6'), 1).rename("B6LVR1"),
        localVariance(imagery.select('B8'), 1).rename("B8LVR1"),
        ee.Terrain.slope(opt.classifier.dem).rename('SLOPE'),
      ]));
    // But only return the bands per opt.classifier.bands (if you don't notice, we normalize all
    // and only the included bands here using some tricky (not so much any more) js).
    var perBandNormalizerFunction = makeNormalizer(imagery);
    return ee.Image(opt.classifier.bands.map(perBandNormalizerFunction));
  }
  // Load the landsat data for both the training and study region (they may differ).
  var data = {
    training: getImagery(opt.training.year, opt.training.minMonth, opt.training.maxMonth),
    study: getImagery(opt.study.year, opt.study.minMonth, opt.study.maxMonth),
  };
  // If we are not classifying (for visualization purposes), abort now & export the 
  // requested bands as-is.
  if (opt.classifier.argument=='falseColor') 
    return data.study.select(opt.classifier.bands);
  // Sample the spectral data on the previous selected pixels.
  var trainingPixelCollection = data.training.sampleRegions({
    collection: representativePixels,
    properties: ['class'],
    scale: opt.proj.scale,
    tileScale: 1,
  });
  // Obtain and output the spectral position of each training region's center
  print(trainingPixelCollection)
  // Train the classifier on this data (note that the past few lines could all be condensed
  // entirely inside of this one line, but it's more readable when broken out like this).
  var classifier = opt.classifier.algorithm.train({
    features: trainingPixelCollection,
    classProperty: 'class', 
    inputProperties: opt.classifier.bands, 
  });
  // Classify the scene
  return data.study.classify(classifier);
}
function getRiverMask(opt, backgroundRegion) {
  return AKHydroStreams.merge(ee.FeatureCollection([ee.Feature(backgroundRegion, { 'OBJECTID': -1 })]))
    .reduceToImage({
      properties: ['OBJECTID'],
      reducer: ee.Reducer.max(),
    }).eq(-1).reproject(opt.proj);
}
function doMorphologicalOps (opt, data, r) {
  return data
    // Open it
    .reduceNeighborhood({
      reducer: ee.Reducer.max(), 
      kernel: ee.Kernel.circle({radius: r})
    }).reproject(opt.proj)
    // Close it twice
    .reduceNeighborhood({
      reducer: ee.Reducer.min(), 
      kernel: ee.Kernel.circle({radius: 2*r})
    }).reproject(opt.proj)
    // Open it again
    .reduceNeighborhood({
      reducer: ee.Reducer.max(), 
      kernel: ee.Kernel.circle({radius: r})
    }).reproject(opt.proj);
}
function exportData(opt, data, site, name, addToMap) {
  // This will visualize it in GEE
  if (addToMap)
    Map.addLayer(data.clip(site), opt.classifier.argument=='rawsearchOpts' || opt.classifier.argument=='rawEuclidian' ? {
      min: 0,
      max: opt.classifier.displayColors.length,
      palette: opt.classifier.displayColors,
    } : { }, name);
  else 
    Export.image.toDrive({
      image: data.clip(site),
      scale: opt.proj.scale,
      description: name,
      folder: 'proglacial' + generation,
      region: site.bounds(),
      maxPixels: 1e13, 
    });
}
function getF1Score(opt, data, regionFeature, truthFeatureCollection, titleString, verbose) {
  // This is our data we're testing.
  var regionOfInterest = data.clip(regionFeature);
  // Convert the truth features into a raster binary.
  var truthMap = truthFeatureCollection.remap([0], [1], 'Id')
    .merge(ee.FeatureCollection([ee.Feature(regionFeature, { 'Id': 0 })]))
    .reduceToImage({
      properties: ['Id'],
      reducer: ee.Reducer.max(),
    });
  // These values will set up the reducer to be accurate over non-rectilinear projections.
  var areaMultiplier = ee.Image.pixelArea();
  // This is the reducer we will use (just adds up all the 1s)
  var reducerParameters = {
    reducer: ee.Reducer.sum(), 
    geometry: regionFeature, 
    scale: opt.proj.scale,
  };
  // Poor man's confusion matrix.
  var truePositives  = ee.Number(
    truthMap.eq(1)
      .and(regionOfInterest.eq(1))
      .multiply(areaMultiplier)
      .reduceRegion(reducerParameters)
      .get('max')
    );
  var trueNegatives  = ee.Number(
    truthMap.eq(0)
      .and(regionOfInterest.eq(0))
      .multiply(areaMultiplier)
      .reduceRegion(reducerParameters)
      .get('max')
    );
  var falsePositives = ee.Number(
    truthMap.eq(1)
      .and(regionOfInterest.eq(0))
      .multiply(areaMultiplier)
      .reduceRegion(reducerParameters)
      .get('max')
    );
  var falseNegatives = ee.Number(
    truthMap.eq(0)
      .and(regionOfInterest.eq(1))
      .multiply(areaMultiplier)
      .reduceRegion(reducerParameters)
      .get('max')
    );
  // Preliminary value
  var precision = truePositives.divide(truePositives.add(falsePositives));
  var recall = truePositives.divide(truePositives.add(falseNegatives));
  // F1 Score
  var F1 = ee.Number(2).multiply(precision.multiply(recall.divide(precision.add(recall))));
  // Display it in the console
  if (verbose) {
    print(titleString + "\nTrue Positives:", truePositives);
    print(titleString + "\nTrue Negatives:", trueNegatives);
    print(titleString + "\nFalse Positives:", falsePositives);
    print(titleString + "\nFalse Negatives:", falseNegatives);
    print(titleString + "\nPrecision:", precision);
    print(titleString + "\nRecall:", recall);
    print(titleString + "\nF1:", F1);
    print(titleString + "\nType 1 Error (omission):", falseNegatives.divide(truePositives.add(falseNegatives)));
    print(titleString + "\nType 2 Error (comission):", falsePositives.divide(truePositives.add(falsePositives)));
  } else {
    print(titleString, F1);
  }
  return F1;
}
function visualizeTruth(site, truthFeatureCollection) {
  // This can be useful in a pinch. Not currently used.
  Map.addLayer(truthFeatureCollection.remap([0], [1], 'Id')
    .merge(ee.FeatureCollection([ee.Feature(site, { 'Id': 0 })]))
    .reduceToImage({
      properties: ['Id'],
      reducer: ee.Reducer.max(),
    }).clip(site),{
  }, "TRUTH");
}
function run(bands, arg, slope, morph, opts) {
  // This is an old version of JS, so you have to manually do this for optional args...
  var useMurkyWater = false; 
  var useJaxaDem = false; 
  if (opts.useMurkyWater!==null) useMurkyWater = opts.useMurkyWater;
  if (opts.useJaxaDem!==null) useJaxaDem = opts.useJaxaDem;
  // This will set up the tag (our file/classifier naming schema)
  function makeTag () {
    // Put distance type in
    var tag = '_'+arg.charAt(0).toUpperCase() + arg.substring(1,3);
    // Timeslice options
    if (opts.year) tag = tag + '_Y' + opts.year;
    if (opts.minMonth) tag = tag + '_M' + opts.minMonth;
    if (opts.maxMonth) tag = tag + '_' + opts.maxMonth;
    // Put bands in the name
    function tagAdder(x) {
      tag = tag + '_' + x;
    }
    bands.map(tagAdder);
    // Put binary options in the name
    if (useMurkyWater) tag = tag + '_Mrk';
    if (useJaxaDem) tag = tag + '_Jax';
    // Put other details in
    if (slope) tag = tag + '_Thr' + slope;
    if (morph) tag = tag + '_Rad' + morph;
    // Put generation in
    // tag = tag + '_' + generation.substrwing(0,3);
    return tag;
  }
  // The options
  var opt = {
    // Get the name of this classification scheme
    tag: makeTag(),
    // Landsat compositing date ranges
    study: {
      year: opts.year || 2018,
      minMonth: opts.minMonth || 7,
      maxMonth: opts.maxMonth || 9,
    }, 
    training: {
      year: 2018,
      minMonth: 7,
      maxMonth: 9,
    },
    // Classifier setup
    classifier: {
      // NOTE: The classified raster will have values starting from ONE in this order! Why starting from
      // one? See the comment near the top inside the makeSampler() function.
      trainingClasses: [
        waterLakeProglacial,    // 1 
        waterLakeNonglacial,    // 2
        waterBlueLake,          // 3
        debrisSupraglacialWet,  // A fourth class may be inserted before here if we are working with murky water.
        debrisSupraglacialDry,
        iceHigh,
        iceGreyGlacial,
        iceHighShadow,
        landWet,
        landFlood,
        landHigh,
        landMud,
        landCliff,
      ],
      // For visualization in GEE
      displayColors: [
        '000000',
        '3fd3ff',
        '187ea5',
        '066aff',
        'ff1818',
        'a10c0c',
        'ffffff',
        'd2d2d2',
        '939393',
        '168502',
        '00e49a',
        'ccff00',
        'da8c2b',
        '6e5419',
      ],
      // This expression may need to be changed. It filters the water classes out from the rest.
      waterExpression: "b() <= 3",
      // Shouldn't need to touch any of this
      argument: arg,
      algorithm: ee.Classifier.minimumDistance(arg=='rawEuclidian' || arg=='euclidian' ? 'euclidian' : arg=='rawMahalanobis' || arg=='mahalanobis' ? 'mahalanobis' : undefined),
      samples: 50,
      bands: bands,
      dem: (useJaxaDem) ? jaxa_dem.select('AVE_DSM') : dem,
    },
    // Projection info. This is the Landsat 8 default.
    proj: { 
      crs: 'EPSG:4326', // World Geodetic System 1984
      scale: 20,
    },
  };
  // Make changes to the options as needed when using the murky water class in the training set.
  if (useMurkyWater) {
    opt.classifier.trainingClasses.splice(3, 0, waterLakeMurky);
    opt.classifier.displayColors.splice(4, 0, '90b1d4');
    opt.classifier.waterExpression = "b() <= 4";
  }
  // Run it
  var data = classify(opt);
  // Further processing
  if (opt.classifier.argument!='falseColor' && opt.classifier.argument!='rawMahalanobis' && opt.classifier.argument!='rawEuclidian') {
    // Apply river mask 
    data = data.multiply(getRiverMask(opt, area4));
    // Apply slope threshold
    data = slope ? data.multiply(ee.Terrain.slope(opt.classifier.dem).lt(slope)) : data;
    // Parse out water regions
    data = data.multiply(data.expression(opt.classifier.waterExpression));
    // Flatten water
    data = data.gt(0);
    // Perform morphological operations
    data = morph ? doMorphologicalOps(opt, data, morph) : data;
  }
  // Export
  if (opts.exportF1) {
    getF1Score(opt, data, area1, area1_truthLakes, 'A1'+opt.tag, false);
    getF1Score(opt, data, area2, area2_truthLakes, 'A2'+opt.tag, false);
    getF1Score(opt, data, area3, area3_truthLakes, 'A3'+opt.tag, false);
  }
  if (opts.exportRaster)
    exportData(opt, data, ee.Feature(jabBuffer.geometry()), "L3km" + opt.tag, false);
  if (opts.showRaster)
    exportData(opt, data, ee.Feature(jabBuffer.geometry()), "L3km" + opt.tag, true);
}

run([ 'B6', 'NDVI', 'B8LVR1' ], 'mahalanobis', 15, 1, { } );

/**************
 * Export TIFs
 */
// Don't run this yet.
// for (var y=2013;y<2020;y++)
//   for (var m=6;m<10;m++)
//     run([ 'B6', 'B5', 'B4' ], 'falseColor', 0, 0, {
//     // run([ 'B6', 'NDVI', 'B8LVR1' ], 'mahalanobis', 5, 3, {
//       //useMurkyWater: true, 
//       //useJaxaDem: true,
//       exportRaster: true,
//       year: y,
//       minMonth: m,
//       maxMonth: m,
//     });

/**************
 * F1 scores
 *
run(['B6', 'NDVI', 'B8LVR1'], 'mahalanobis', 15, 3, {
  useMurkyWater: true, 
  useJaxaDem: true,
  exportF1: true,
});
/*/
    
    
    
    